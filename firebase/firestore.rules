rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Helper function
    function isAuthed() {
      return request.auth != null;
    }

    // Users collection - Anonymous users için tamamen açık
    match /users/{uid} {
      allow read, write: if isAuthed(); // Anonymous users için tüm işlemler
    }

    // Chats collection - Gevşetilmiş kurallar
    match /chats/{chatId} {
      allow read: if isAuthed();
      allow create: if isAuthed();
      allow update: if isAuthed();
      allow delete: if false; // Chats can't be deleted
    }

    // Messages subcollection - Gevşetilmiş kurallar
    match /messages/{chatId}/items/{messageId} {
      allow read, write: if isAuthed();
    }

    // Typing indicators - Gevşetilmiş kurallar
    match /typing/{chatId}/users/{uid} {
      allow read, write: if isAuthed();
    }

    // User discovery - Gevşetilmiş kurallar
    match /discovery/{docId} {
      allow read, write: if isAuthed();
    }

    // Connection requests - Gevşetilmiş kurallar
    match /connectionRequests/{requestId} {
      allow read, write: if isAuthed();
    }
  }
}
